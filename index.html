<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Higher or Lower - India Edition</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8, 0, 1, 1); }
            50% { transform: translateY(0); animation-timing-function: cubic-bezier(0, 0, 0.2, 1); }
        }
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        @keyframes float-up {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }
        .float-up {
            animation: float-up 1s ease-out;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Category emoji mapping with fallback images
        const categoryEmojis = {
            'Bollywood & Indian Cinema': 'üé¨',
            'Cricket': 'üèè',
            'Indian Celebrities & Influencers': '‚≠ê',
            'Indian YouTube': 'üì∫',
            'Indian Brands & Companies': 'üíº',
            'Real Estate (India)': 'üè†',
            'Indian Music & Streaming': 'üéµ',
            'Indian Cars & Bikes': 'üöó',
            'Indian Geography & Tourism': 'üó∫Ô∏è',
            'Indian Shopping & Luxury': 'üíé',
            'Indian Web & Apps': 'üì±',
            'Indian Reality TV & OTT': 'üì∫',
            'Indian Books & Literature': 'üìö',
            'Indian Politics': 'üèõÔ∏è',
            'Indian Food & Restaurants': 'üçõ'
        };

        // Fallback images for categories
        const categoryFallbacks = {
            'Bollywood & Indian Cinema': 'https://cdn-icons-png.flaticon.com/512/3163/3163498.png',
            'Cricket': 'https://cdn-icons-png.flaticon.com/512/1533/1533913.png',
            'Indian Celebrities & Influencers': 'https://cdn-icons-png.flaticon.com/512/1077/1077114.png',
            'Indian YouTube': 'https://cdn-icons-png.flaticon.com/512/1384/1384060.png',
            'Indian Brands & Companies': 'https://cdn-icons-png.flaticon.com/512/3135/3135706.png',
            'Real Estate (India)': 'https://cdn-icons-png.flaticon.com/512/619/619032.png',
            'Indian Music & Streaming': 'https://cdn-icons-png.flaticon.com/512/727/727267.png',
            'Indian Cars & Bikes': 'https://cdn-icons-png.flaticon.com/512/171/171239.png',
            'Indian Geography & Tourism': 'https://cdn-icons-png.flaticon.com/512/854/854878.png',
            'Indian Shopping & Luxury': 'https://cdn-icons-png.flaticon.com/512/2331/2331966.png',
            'Indian Web & Apps': 'https://cdn-icons-png.flaticon.com/512/733/733585.png',
            'Indian Reality TV & OTT': 'https://cdn-icons-png.flaticon.com/512/3074/3074767.png',
            'Indian Books & Literature': 'https://cdn-icons-png.flaticon.com/512/167/167755.png',
            'Indian Politics': 'https://cdn-icons-png.flaticon.com/512/3004/3004458.png',
            'Indian Food & Restaurants': 'https://cdn-icons-png.flaticon.com/512/3075/3075977.png'
        };

        // SVG Icons
        const Trophy = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
                <path d="M4 22h16"></path>
                <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
                <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
                <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
            </svg>
        );

        const Zap = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
            </svg>
        );

        const RotateCcw = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                <path d="M3 3v5h5"></path>
            </svg>
        );

        const Share2 = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="18" cy="5" r="3"></circle>
                <circle cx="6" cy="12" r="3"></circle>
                <circle cx="18" cy="19" r="3"></circle>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
            </svg>
        );

        const ArrowLeft = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
        );

        function HigherOrLowerGame() {
            const [categories, setCategories] = useState([]);
            const [selectedCategory, setSelectedCategory] = useState(null);
            const [score, setScore] = useState(0);
            const [streak, setStreak] = useState(0);
            const [bestStreak, setBestStreak] = useState(0);
            const [globalBestScore, setGlobalBestScore] = useState(0);
            const [currentPair, setCurrentPair] = useState([]);
            const [usedItems, setUsedItems] = useState([]);
            const [revealed, setRevealed] = useState(false);
            const [result, setResult] = useState(null);
            const [gameOver, setGameOver] = useState(false);
            const [animation, setAnimation] = useState('');
            const [loading, setLoading] = useState(true);
            const [showSuccess, setShowSuccess] = useState(false);
            const [clickedSide, setClickedSide] = useState(null);

            useEffect(() => {
                loadGameData();
                loadGlobalBestScore();
            }, []);

            const parseValue = (valueStr) => {
                if (!valueStr) return 0;
                const str = valueStr.toString().trim();
                
                // Remove currency symbols and units
                let cleaned = str.replace(/[‚Çπ$,]/g, '').trim();
                
                // Handle different suffixes
                if (cleaned.includes('Cr')) {
                    return parseFloat(cleaned.replace('Cr', '').trim());
                } else if (cleaned.includes('Lakh')) {
                    return parseFloat(cleaned.replace('Lakh', '').trim()) / 100;
                } else if (cleaned.includes('k units')) {
                    return parseFloat(cleaned.replace('k units', '').trim()) / 1000;
                } else if (cleaned.includes('M')) {
                    return parseFloat(cleaned.replace('M', '').trim());
                } else if (cleaned.includes('B')) {
                    return parseFloat(cleaned.replace('B', '').trim()) * 1000;
                } else if (cleaned.includes('Billion USD')) {
                    return parseFloat(cleaned.replace('Billion USD', '').trim());
                } else if (cleaned.includes('Million')) {
                    return parseFloat(cleaned.replace('Million', '').trim());
                } else if (cleaned.includes('copies')) {
                    return parseFloat(cleaned.replace(/[M+copies]/g, '').trim());
                } else if (cleaned.includes('views')) {
                    return parseFloat(cleaned.replace('views', '').trim());
                }
                
                return parseFloat(cleaned) || 0;
            };

            const parseCSVLine = (line) => {
                // Split by comma but we know the structure:
                // Category,Subcategory,Rank,Name,Value,ImageURL
                // Value might contain commas, so we need special handling
                
                const parts = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        parts.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                parts.push(current.trim());
                
                // If we have more than 6 parts, the Value column had commas
                // Merge parts[4] onwards until we have exactly 6 columns
                if (parts.length > 6) {
                    const fixedParts = [
                        parts[0], // Category
                        parts[1], // Subcategory
                        parts[2], // Rank
                        parts[3], // Name
                        parts.slice(4, parts.length - 1).join(','), // Value (merge middle parts)
                        parts[parts.length - 1] // ImageURL (last part)
                    ];
                    return fixedParts;
                }
                
                // If we have 5 columns, ImageURL is missing
                if (parts.length === 5) {
                    parts.push('');
                }
                
                return parts;
            };

            const loadGameData = async () => {
                try {
                    const response = await fetch('data.json');
                    const text = await response.text();
                    
                    // Parse CSV manually
                    const lines = text.split('\n').filter(line => line.trim());
                    const headers = lines[0].split(',');
                    
                    const groupedData = {};
                    
                    for (let i = 1; i < lines.length; i++) {
                        const values = parseCSVLine(lines[i]);
                        if (values.length < 6) continue;
                        
                        const category = values[0];
                        const subcategory = values[1];
                        const rank = values[2];
                        const name = values[3];
                        const value = values[4];
                        const imageURL = values[5];
                        
                        if (!category || !name || !value) continue;
                        
                        // Use subcategory as the unique key
                        const key = subcategory || category;
                        
                        if (!groupedData[key]) {
                            groupedData[key] = {
                                name: category,
                                subcategory: subcategory || category,
                                emoji: categoryEmojis[category] || 'üìä',
                                items: []
                            };
                        }
                        
                        groupedData[key].items.push({
                            name: name,
                            value: parseValue(value),
                            displayValue: value,
                            imageURL: imageURL || '',
                            rank: parseInt(rank) || 0
                        });
                    }
                    
                    const categoriesArray = Object.values(groupedData);
                    setCategories(categoriesArray);
                    setLoading(false);
                } catch (error) {
                    console.error('Error loading game data:', error);
                    alert('Error: ' + error.message);
                    setLoading(false);
                }
            };

            const loadGlobalBestScore = async () => {
                try {
                    const result = await window.storage.get('global-best-score', true);
                    if (result && result.value) {
                        setGlobalBestScore(parseInt(result.value));
                    }
                } catch (error) {
                    console.log('No global best score found yet');
                }
            };

            const updateGlobalBestScore = async (newScore) => {
                if (newScore > globalBestScore) {
                    setGlobalBestScore(newScore);
                    try {
                        await window.storage.set('global-best-score', newScore.toString(), true);
                    } catch (error) {
                        console.error('Error saving global best score:', error);
                    }
                }
            };

            const selectCategory = (category) => {
                setSelectedCategory(category);
                setUsedItems([]);
                generateNewPair(category.items, []);
            };

            const generateNewPair = (items, used) => {
                // Filter out used items
                let availableItems = items.filter(item => 
                    !used.some(usedItem => usedItem.name === item.name)
                );
                
                // Reset used items if running low
                if (availableItems.length < 10) {
                    availableItems = items;
                    setUsedItems([]);
                    used = [];
                }
                
                // Sort by value for smart pairing
                const sorted = [...availableItems].sort((a, b) => a.value - b.value);
                
                // Pick first item randomly
                const firstIdx = Math.floor(Math.random() * sorted.length);
                const firstItem = sorted[firstIdx];
                
                // Find items within ¬±40% value range
                const minValue = firstItem.value * 0.6;
                const maxValue = firstItem.value * 1.4;
                
                const closeItems = sorted.filter(item => 
                    item.name !== firstItem.name &&
                    item.value >= minValue && 
                    item.value <= maxValue
                );
                
                // If no close items found, pick from wider range
                const secondItem = closeItems.length > 0
                    ? closeItems[Math.floor(Math.random() * closeItems.length)]
                    : sorted.filter(item => item.name !== firstItem.name)[Math.floor(Math.random() * (sorted.length - 1))];
                
                setCurrentPair([firstItem, secondItem]);
                setUsedItems([...used, firstItem, secondItem]);
                setRevealed(false);
                setResult(null);
                setAnimation('');
                setShowSuccess(false);
                setClickedSide(null);
            };

            const handleGuess = (selected) => {
                if (revealed || gameOver) return;

                setClickedSide(selected);
                const [left, right] = currentPair;
                const correct = (selected === 'left' && left.value >= right.value) || 
                               (selected === 'right' && right.value >= left.value);

                setRevealed(true);
                setResult(correct ? 'correct' : 'wrong');
                setAnimation(correct ? 'correct' : 'wrong');

                if (correct) {
                    setShowSuccess(true);
                    const newScore = score + 1;
                    setScore(newScore);
                    setStreak(streak + 1);
                    if (streak + 1 > bestStreak) setBestStreak(streak + 1);
                    updateGlobalBestScore(newScore);
                    setTimeout(() => {
                        generateNewPair(selectedCategory.items, usedItems);
                    }, 2500);
                } else {
                    setStreak(0);
                    updateGlobalBestScore(score);
                    setTimeout(() => setGameOver(true), 5000);
                }
            };

            const resetGame = () => {
                setScore(0);
                setStreak(0);
                setGameOver(false);
                setSelectedCategory(null);
                setUsedItems([]);
            };

            const shareScore = () => {
                const text = `I scored ${score} points in Higher or Lower - India Edition! Can you beat my score? üáÆüá≥`;
                if (navigator.share) {
                    navigator.share({ text });
                } else {
                    navigator.clipboard.writeText(text);
                    alert('Score copied to clipboard!');
                }
            };

            if (loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-orange-400 via-white to-green-400 flex items-center justify-center">
                        <div className="text-2xl font-bold text-gray-800">Loading...</div>
                    </div>
                );
            }

            if (categories.length === 0) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-orange-400 via-white to-green-400 flex items-center justify-center">
                        <div className="text-2xl font-bold text-red-600">Error loading game data</div>
                    </div>
                );
            }

            // Category Selection Screen
            if (!selectedCategory && !gameOver) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-orange-400 via-white to-green-400 p-4">
                        <div className="max-w-6xl mx-auto">
                            <div className="text-center mb-8">
                                <h1 className="text-6xl font-bold text-gray-800 mb-2 drop-shadow-lg">
                                    üáÆüá≥ Higher or Lower
                                </h1>
                                <p className="text-gray-600 text-xl mb-4">India Edition</p>
                                {globalBestScore > 0 && (
                                    <div className="inline-block bg-yellow-500 text-white px-6 py-2 rounded-full font-bold">
                                        üèÜ Global Best: {globalBestScore}
                                    </div>
                                )}
                            </div>

                            <h2 className="text-3xl font-bold text-gray-800 mb-6 text-center">Choose a Category</h2>
                            
                            <div className="grid md:grid-cols-3 gap-4">
                                {categories.map((category, idx) => (
                                    <button
                                        key={idx}
                                        onClick={() => selectCategory(category)}
                                        className="bg-white rounded-2xl shadow-xl p-6 hover:scale-105 transition-all transform hover:shadow-2xl"
                                    >
                                        <div className="text-center">
                                            <div className="text-5xl mb-3">{category.emoji}</div>
                                            <h3 className="text-lg font-bold text-gray-800 leading-tight mb-2">
                                                {category.name}
                                            </h3>
                                            <p className="text-sm text-gray-500 mb-2">{category.subcategory}</p>
                                            <p className="text-gray-500 text-sm">
                                                {category.items.length} items
                                            </p>
                                        </div>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-orange-400 via-white to-green-400 p-4">
                    <div className="max-w-6xl mx-auto">
                        {/* Header */}
                        <div className="text-center mb-6">
                            <h1 className="text-5xl font-bold text-gray-800 mb-2 drop-shadow-lg">
                                üáÆüá≥ Higher or Lower
                            </h1>
                            <p className="text-gray-600 text-lg">{selectedCategory?.subcategory}</p>
                        </div>

                        {/* Stats Bar */}
                        <div className="bg-white/80 backdrop-blur rounded-2xl shadow-xl p-4 mb-6 flex justify-around items-center">
                            <div className="flex items-center gap-2">
                                <div className="text-yellow-500"><Trophy /></div>
                                <div>
                                    <div className="text-2xl font-bold text-gray-800">{score}</div>
                                    <div className="text-xs text-gray-600">Score</div>
                                </div>
                            </div>
                            <div className="flex items-center gap-2">
                                <div className="text-orange-500"><Zap /></div>
                                <div>
                                    <div className="text-2xl font-bold text-gray-800">{streak}</div>
                                    <div className="text-xs text-gray-600">Streak</div>
                                </div>
                            </div>
                            <div className="flex items-center gap-2">
                                <div className="text-green-500">üåü</div>
                                <div>
                                    <div className="text-2xl font-bold text-gray-800">{globalBestScore}</div>
                                    <div className="text-xs text-gray-600">Global Best</div>
                                </div>
                            </div>
                        </div>

                        {/* Game Over Screen */}
                        {gameOver && (
                            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
                                <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full mx-4 text-center">
                                    <div className="text-6xl mb-4">üéÆ</div>
                                    <h2 className="text-3xl font-bold text-gray-800 mb-4">Game Over!</h2>
                                    <div className="mb-6">
                                        <div className="text-5xl font-bold text-orange-500 mb-2">{score}</div>
                                        <div className="text-gray-600">Final Score</div>
                                        <div className="mt-4 text-sm text-gray-500">
                                            Best Streak: {bestStreak} üî•
                                        </div>
                                        {score === globalBestScore && score > 0 && (
                                            <div className="mt-2 text-green-600 font-bold">
                                                üéâ New Global Record!
                                            </div>
                                        )}
                                    </div>
                                    <div className="flex gap-3">
                                        <button
                                            onClick={resetGame}
                                            className="flex-1 bg-gradient-to-r from-orange-500 to-green-500 text-white py-3 px-6 rounded-xl font-semibold hover:shadow-lg transition-all flex items-center justify-center gap-2"
                                        >
                                            <RotateCcw />
                                            Play Again
                                        </button>
                                        <button
                                            onClick={shareScore}
                                            className="flex-1 bg-blue-500 text-white py-3 px-6 rounded-xl font-semibold hover:shadow-lg transition-all flex items-center justify-center gap-2"
                                        >
                                            <Share2 />
                                            Share
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Back Button */}
                        {!gameOver && (
                            <button
                                onClick={() => setSelectedCategory(null)}
                                className="mb-4 bg-white/80 backdrop-blur px-4 py-2 rounded-xl font-semibold hover:shadow-lg transition-all flex items-center gap-2"
                            >
                                <ArrowLeft />
                                Change Category
                            </button>
                        )}

                        {/* Game Cards */}
                        {currentPair.length === 2 && (
                            <div className="grid md:grid-cols-2 gap-4 relative">
                                {currentPair.map((item, idx) => {
                                    const side = idx === 0 ? 'left' : 'right';
                                    const wasClicked = clickedSide === side;
                                    const isCorrect = result === 'correct';
                                    
                                    return (
                                        <button
                                            key={idx}
                                            onClick={() => handleGuess(side)}
                                            disabled={revealed || gameOver}
                                            className={`relative bg-white rounded-3xl shadow-2xl p-8 transition-all transform hover:scale-105 hover:shadow-3xl ${
                                                revealed ? 'cursor-default' : 'cursor-pointer'
                                            } ${
                                                wasClicked && isCorrect ? 'ring-8 ring-green-500 bg-green-50' : ''
                                            } ${
                                                wasClicked && !isCorrect ? 'ring-8 ring-red-500 bg-red-50 animate-pulse' : ''
                                            }`}
                                        >
                                            {/* Result Badge - ONLY on clicked card */}
                                            {revealed && wasClicked && (
                                                <div className={`absolute -top-6 left-1/2 transform -translate-x-1/2 px-8 py-4 rounded-2xl font-bold text-white text-2xl shadow-2xl z-20 ${
                                                    isCorrect ? 'bg-green-500 animate-bounce' : 'bg-red-500'
                                                }`}>
                                                    {isCorrect ? '‚úì CORRECT!' : '‚úó WRONG!'}
                                                </div>
                                            )}

                                            {/* Success Animation */}
                                            {showSuccess && wasClicked && isCorrect && (
                                                <div className="absolute top-4 right-4 text-5xl font-bold text-green-500 float-up">
                                                    +1
                                                </div>
                                            )}

                                            {/* Image */}
                                            <div className="w-full h-48 mb-4 rounded-xl overflow-hidden bg-gradient-to-br from-orange-200 to-green-200 flex items-center justify-center">
                                                {item.imageURL ? (
                                                    <img 
                                                        src={item.imageURL} 
                                                        alt={item.name}
                                                        className="w-full h-full object-contain"
                                                        style={{objectPosition: 'center'}}
                                                        onError={(e) => {
                                                            // Try category fallback image first
                                                            const fallbackImg = categoryFallbacks[selectedCategory.name];
                                                            if (fallbackImg && e.target.src !== fallbackImg) {
                                                                e.target.src = fallbackImg;
                                                            } else {
                                                                // If fallback also fails, show emoji
                                                                e.target.style.display = 'none';
                                                                e.target.parentElement.innerHTML = '<div class="text-8xl">' + selectedCategory.emoji + '</div>';
                                                            }
                                                        }}
                                                    />
                                                ) : (
                                                    <img 
                                                        src={categoryFallbacks[selectedCategory.name] || 'https://via.placeholder.com/400x300?text=' + encodeURIComponent(item.name)}
                                                        alt={item.name}
                                                        className="w-full h-full object-contain"
                                                        onError={(e) => {
                                                            e.target.style.display = 'none';
                                                            e.target.parentElement.innerHTML = '<div class="text-8xl">' + selectedCategory.emoji + '</div>';
                                                        }}
                                                    />
                                                )}
                                            </div>

                                            {/* Name */}
                                            <h3 className="text-2xl font-bold text-gray-800 mb-4 text-center min-h-[60px] flex items-center justify-center">
                                                {item.name}
                                            </h3>

                                            {/* Value */}
                                            <div className="text-center">
                                                {revealed ? (
                                                    <div className="text-3xl font-bold text-orange-500">
                                                        {item.displayValue}
                                                    </div>
                                                ) : (
                                                    <div className="text-4xl font-bold text-gray-300">???</div>
                                                )}
                                            </div>
                                        </button>
                                    );
                                })}
                                
                                {/* VS Badge */}
                                <div className="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-gradient-to-r from-orange-500 to-green-500 text-white font-bold text-2xl px-6 py-3 rounded-full shadow-2xl z-10 hidden md:block">
                                    VS
                                </div>
                            </div>
                        )}

                        {/* Instructions */}
                        {score === 0 && !revealed && (
                            <div className="mt-6 text-center text-gray-600 animate-bounce">
                                üëÜ Click the card with the HIGHER value!
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<HigherOrLowerGame />, document.getElementById('root'));
    </script>
</body>
</html>
